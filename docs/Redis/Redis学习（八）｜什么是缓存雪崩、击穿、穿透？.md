---
title: Redis学习（八）｜什么是缓存雪崩、击穿、穿透？
date: 2024-05-06
---
<!-- TOC -->
* [定义和原因](#定义和原因)
  * [缓存雪崩（Cache Avalanche）](#缓存雪崩cache-avalanche)
  * [缓存击穿（Cache Miss）](#缓存击穿cache-miss)
  * [缓存穿透（Cache Penetration）](#缓存穿透cache-penetration)
* [区别](#区别)
* [如何避免](#如何避免)
  * [缓存雪崩的预防](#缓存雪崩的预防)
  * [缓存击穿的预防](#缓存击穿的预防)
  * [缓存穿透的预防](#缓存穿透的预防)
  * [其他预防措施](#其他预防措施)
<!-- TOC -->

缓存雪崩、击穿和穿透是在缓存系统中常见的问题，它们都可能导致缓存系统的性能下降或者服务不可用。
# 定义和原因
## 缓存雪崩（Cache Avalanche）

- 定义：缓存雪崩是指在缓存中大量的数据同时过期或者失效，导致大量请求直接访问数据库或后端系统，使得数据库负载骤增，甚至引发系统崩溃。
- 原因：通常发生在缓存数据的过期时间设置过于相似，或者缓存服务器宕机导致大量请求无法命中缓存。
## 缓存击穿（Cache Miss）

- 定义：缓存击穿是指一个缓存的热点数据在缓存失效的瞬间，被大量并发请求同时访问，导致请求直接访问数据库或后端系统。
- 原因：通常发生在某个热点数据的缓存过期，或者因为某些原因在缓存中不存在，而且此时有大量请求同时访问这个数据。
## 缓存穿透（Cache Penetration）

- 定义：缓存穿透是指恶意用户发送大量查询数据库中不存在的数据的请求，导致请求绕过缓存直接访问数据库，从而引起数据库负载过高甚至宕机。
- 原因：通常发生在用户恶意查询不存在的数据，或者查询一些非常规的数据，导致缓存中无法命中，而且这些请求的并发量很高。
# 区别

- **缓存雪崩**是整个缓存系统的大面积崩溃，通常是因为大量缓存数据同时过期而导致的；
- **缓存击穿**是某个热点数据缓存失效时，导致大量请求直接访问数据库，而其他缓存数据仍然有效；
- **缓存穿透**则是由于恶意用户请求大量不存在于缓存中的数据，导致这些请求直接访问数据库。
# 如何避免
避免缓存雪崩、击穿和穿透是非常重要的，它们可能导致系统性能下降甚至崩溃。为了避免缓存雪崩、击穿和穿透，可以采取一系列措施，如合理设置缓存过期时间、使用热点数据预热、实现缓存穿透保护机制等。
## 缓存雪崩的预防

- **设置随机的过期时间**：避免所有缓存同时过期，可以设置随机的过期时间，以平均分散缓存的失效时间。
- **使用缓存高可用架构**：确保缓存系统的高可用性，采用主从复制、集群等架构，以防止单点故障导致的雪崩效应。
## 缓存击穿的预防

- **使用互斥锁或分布式锁**：在缓存失效时，使用互斥锁或分布式锁来控制对数据库的访问，只允许一个线程去查询数据库，其他线程等待查询结果。
- **设置热点数据永不过期**：对于热点数据，可以将其设置为永不过期，确保即使缓存失效也能够立即重新加载到缓存中。
## 缓存穿透的预防

- **缓存空对象或错误标记**：对于查询不存在的数据，可以将空对象或错误标记缓存起来，防止恶意请求频繁访问数据库。
- **布隆过滤器**：使用布隆过滤器等数据结构来过滤掉明显无效的请求，减少对数据库的访问。
## 其他预防措施

- **限流控制**：通过限流来控制恶意请求的访问频率，减少对系统的压力。
- **监控和报警**：定期监控缓存系统的状态和性能指标，及时发现潜在问题并采取措施解决。

综上所述，通过合理设置缓存过期时间、使用锁机制、设置热点数据永不过期、使用布隆过滤器、限流控制以及定期监控和报警等方法，可以有效地预防缓存雪崩、击穿和穿透的发生，提高系统的稳定性和性能。
