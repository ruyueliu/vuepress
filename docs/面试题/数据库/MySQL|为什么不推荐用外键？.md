---
title: MySQL|为什么不推荐用外键？
date: 2024-04-01
---

# 了解外键
外键（Foreign Key）是关系数据库中的重要概念，用于建立表与表之间的关联关系。外键约束确保了数据的完整性和一致性，通过指定表中的一列或多列与另一表的主键或唯一键进行关联。这部分将介绍外键的基本概念、使用方法以及最佳实践。
## 基本概念
### 1. 外键约束
外键约束是数据库表中的一种约束，用于确保数据的完整性。它定义了一个表中的列（或列组合），这些列的值必须在另一表的主键或唯一键中存在。
### 2. 外键关系
外键关系指的是两个表之间的关联关系，其中一个表的列（或列组合）与另一个表的主键或唯一键相关联。
### 3. 父表和子表

在外键关系中，拥有主键或唯一键的表称为“父表”，而引用该主键或唯一键的表称为“子表”。
## 使用方法
### 1. 创建外键约束
在创建表时，可以使用 `FOREIGN KEY` 关键字指定外键约束。语法如下：

```sql
CREATE TABLE 子表名 (
    列名 数据类型,
    ...
    FOREIGN KEY (列名) REFERENCES 父表名(父表列名)
);
```
### 2. 修改现有表添加外键约束
可以使用 `ALTER TABLE` 语句修改现有表以添加外键约束。语法如下：
```sql
ALTER TABLE 子表名
ADD CONSTRAINT 约束名 FOREIGN KEY (列名)
REFERENCES 父表名(父表列名);
```
### 3. 删除外键约束
可以使用 `ALTER TABLE` 语句删除现有表中的外键约束。语法如下：
```sql
ALTER TABLE 子表名
DROP FOREIGN KEY 约束名;
```
## 最佳实践
### 1. 建立正确的关联关系
在设计数据库时，确保建立正确的关联关系是至关重要的。这意味着仔细考虑哪些列应该成为外键，以及它们与父表的关系。
### 2. 使用索引提高性能
为外键列创建索引可以提高查询性能，特别是在子表中有大量数据的情况下。
### 3. 考虑级联操作
在定义外键约束时，可以选择定义级联操作以处理父表中的更新或删除操作对子表的影响。常见的级联操作包括级联更新（CASCADE UPDATE）和级联删除（CASCADE DELETE）。
## 总结
外键是关系数据库中维护数据完整性和一致性的重要工具之一。通过建立正确的关联关系和使用适当的约束，可以确保数据库中的数据保持一致性，并提高查询性能。在设计数据库时，应该仔细考虑外键的使用方法和最佳实践，以确保数据库结构的健壮性和可维护性。
# 为什么不推荐使用外键？
虽然外键在确保数据完整性和一致性方面非常有用，但有时候也存在一些情况不推荐使用外键的考虑：

1.  **性能影响：** 在大型数据库中，外键的维护可能会对性能产生一定的影响。特别是在大量数据插入、更新和删除操作时，外键约束需要进行额外的检查和维护，可能会导致性能下降。
2.  **复杂性：** 当数据库模型比较复杂时，使用外键约束可能会增加数据库设计的复杂性。管理和维护复杂的外键关系可能会变得困难，尤其是在数据模式变更时。
3.  **应用层控制：** 有些开发者更喜欢单独在应用程序中处理数据完整性，而不是依赖于数据库层面的外键约束。他们认为应用程序中的代码更易于控制和调试，并且可以提供更加灵活的处理方式。
4.  **跨平台兼容性：** 在跨平台的应用开发中，数据库系统的差异可能会导致外键约束的行为不一致。某些数据库系统对外键的支持和实现方式可能不同，这可能会导致应用程序在不同的数据库系统上出现不一致的行为。
5.  **迁移和备份：** 在数据库迁移和备份过程中，外键约束可能会增加复杂性。某些情况下，可能需要禁用或删除外键约束，以便更轻松地进行迁移和备份操作。
6. **分库分表**：当数据量非常大的时候，常见手段是分库分表，但外键通常难以跨越不同数据库来建立联系，数据的一致性更难维护

虽然在**单机低并发业务中**外键约束对于确保数据的完整性和一致性非常有用，但在**分布式、高并发集群**情况下，开发者可能会选择通过其他方式来管理数据完整性，或者根据特定的需求和情况来决定是否使用外键约束。


# 外键常见面试题
在数据库相关的面试中，可能会遇到以下与外键相关的问题，以下是问题及其可能的答案：
### 1. 什么是外键（Foreign Key）？
**答案：** 外键是关系数据库中的一个重要概念，用于建立表与表之间的关联关系。它是一种约束，确保在一个表中的值必须在另一个表的主键或唯一键中存在。
### 2. 外键的作用是什么？
**答案：** 外键的作用包括：

- 建立表与表之间的关联关系，促进数据的相关性和一致性。
- 确保数据的完整性，防止在子表中插入无效的引用。
- 规范化数据库设计，减少数据冗余和不一致性。
### 3. 外键和索引有什么区别？
**答案：** 外键和索引都是用于提高数据库性能和数据完整性的工具，但它们的作用和实现方式有所不同。外键是一种约束，用于确保关联表之间的数据完整性和一致性；而索引是一种数据结构，用于加速数据库的检索操作。
### 4. 外键的几种级联操作有哪些？
**答案：** 外键可以定义不同的级联操作来处理父表中的更新或删除操作对子表的影响，常见的级联操作包括：

- CASCADE：级联更新或删除，父表的更新或删除操作会自动传播到子表。
- SET NULL：在父表的更新或删除操作时，将子表中对应外键列的值设为 NULL。
- RESTRICT：限制更新或删除操作，如果父表中存在相关的子表数据，则拒绝执行更新或删除操作。
- NO ACTION：与 RESTRICT 类似，用于限制更新或删除操作。
### 5. 何时使用外键？
**答案：** 使用外键的场景包括：

- 需要建立表与表之间的关联关系，确保数据的一致性和完整性。
- 需要规范化数据库设计，减少数据冗余和不一致性。
- 需要实现级联操作，以便在父表中的更新或删除操作时，自动更新或删除相关的子表数据。
### 6. 外键的缺点是什么？
**答案：** 外键的缺点包括：

- 引入了额外的约束，增加了数据库的复杂度。
- 在执行大量的插入、更新或删除操作时，可能会导致性能下降。
- 外键约束可能限制了一些特定的操作，例如在父表中删除记录时，需要先删除相关的子表记录。

这些问题和答案可以帮助应聘者准备数据库相关面试，并展示其对数据库设计和管理的理解和经验。



**对于更新来说，级联更新是强阻塞，存在数据库更新风暴（Database Update Storm）的风险**。
所谓 Database Update Storm，指的是在高并发环境下，多个客户端同时对数据库进行大量的更新操作，存在锁竞争问题甚至死锁，从而导致数据库性能急剧下降或完全崩溃。

